pipeline {
    agent any

    parameters {
        string(name: 'INCREMENT_TYPE', defaultValue: 'patch', description: 'Increment type (patch, minor, major)')
    }

    stages {
        stage('Release Preparation') {
            steps {
                script {
                    sh """
                        set -e
                        commit_hash=\$(git rev-parse --short HEAD)
                        tag_name="dev.\${commit_hash}"
                        version=\$(jq -r '.version' package.json)
                        release-it --increment=\${INCREMENT_TYPE} --release-version=\$version
                        release-it --no-npm --ci --git.tagName=\${version}.\$tag_name
                    """
                }
            }
        }

    }
}
